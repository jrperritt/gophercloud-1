#!/bin/bash

# Load our library functions
SCRIPT_DIR=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
source "${SCRIPT_DIR}/lib.sh"

build() {
  if [ -n "$GOPATH" ]; then
    echo "Building stack!"

    STACKBUILD=${1:-${GOPATH}/bin/stack}

    get_commit
    get_version

    cd ${SCRIPT_DIR}/../main

    LDFLAGS="-X github.com/gophercloud/gophercloud/cli/version.Commit=${COMMIT} \
             -X github.com/gophercloud/gophercloud/cli/version.Version=${VERSION}"
    go build -a -ldflags "${LDFLAGS}" -o "${STACKBUILD}"
    return $?
  else
    echo "\$GOPATH must be defined. Do you have go setup?"
    return 1
  fi
}

build "$1"
